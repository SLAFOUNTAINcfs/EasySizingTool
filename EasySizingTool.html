<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>EAST</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles/migrationtool.css" />
  <link rel="stylesheet" href="styles/pricing.css" />
</head>
<body>
  <div class="container">
    <h1>Easy Application Sizing Tool</h1>
    <div class="export-import-controls">
      <button id="exportBtn" type="button">Export Progress</button>
      <label for="importInput" class="visually-hidden">Import Progress File</label>
      <input id="importInput" type="file" accept="application/json" title="Import Progress File (JSON)" />
      <button id="importBtn" type="button">Import Progress</button>
    </div>
    <p class="muted">Fill out the application information and migration drivers, then click "Recalculate" to estimate effort and compare Standard, Recommended, and Express options.</p>

    <div class="card">
      <h2>1. Application Information</h2>
      <div class="grid options-grid">
        <div><label for="appName">Application Name</label><input id="appName" type="text" /></div>
        <div><label for="cloudStrategyDM">Cloud Strategy Decision Maker</label><input id="cloudStrategyDM" type="text" /></div>
        <div><label for="cloudImplDM">Cloud Implementation Decision Maker</label><input id="cloudImplDM" type="text" /></div>
        <div><label for="appOwner">Application Owner(s)</label><input id="appOwner" type="text" /></div>
        <div>
          <label for="ownerAvailability">Owner Availability Next 4 Weeks</label>
          <select id="ownerAvailability">
            <option value="">–</option><option>Yes</option><option>No</option><option>Partial</option>
          </select>
        </div>
        <div><label for="azureSub">Azure Subscription Established</label><select id="azureSub"><option value="">–</option><option>Yes</option><option>No</option></select></div>
        <div>
          <label for="rolePerms">Required Role Permissions Available</label>
          <select id="rolePerms">
            <option value="">–</option><option>Owner</option><option>Contributor</option><option>Reader</option><option>Yes</option><option>No</option>
          </select>
        </div>
        <div><label for="azureExp">Azure Experience Level</label><select id="azureExp"><option value="">–</option><option>New</option><option>Moderate</option><option>Advanced</option></select></div>
        <div><label for="archDiagram">Architecture Diagram Available</label><select id="archDiagram"><option value="">–</option><option>Yes</option><option>No</option></select></div>
        <div><label for="dbDiagram">Database Diagram Available</label><select id="dbDiagram"><option value="">–</option><option>Yes</option><option>No</option></select></div>
        <div class="full-width"><label for="notes">Notes</label><textarea id="notes"></textarea></div>
      </div>
    </div>

    <div class="card">
      <h2>2. Security &amp; Environment Context</h2>
      <div class="grid options-grid security-layout">
        <fieldset class="security-left">
          <legend>Enclaves the app exists in (current state)</legend>
          <label><input id="enclaveIL2" type="checkbox" /> IL2</label>
          <label><input id="enclaveIL4" type="checkbox" /> IL4</label>
          <label><input id="enclaveIL5" type="checkbox" /> IL5</label>
          <label><input id="enclaveIL6" type="checkbox" /> IL6</label>
          <label><input id="enclaveOther" type="checkbox" /> Other</label>
        </fieldset>
        <div class="security-right">
          <div>
            <label for="impactLevelRequired">Impact Level Required (target state)</label>
            <select id="impactLevelRequired">
              <option value="1">IL2</option>
              <option value="2">IL4</option>
              <option value="3">IL5</option>
              <option value="4">IL6</option>
              <option value="2">Other</option>
            </select>
          </div>
          <div><label for="secCap">CAP</label><select id="secCap"><option value="0">N/A</option><option value="3">Yes</option><option value="0">No</option></select></div>
          <div><label for="atoNeeded">ATO Needed</label><select id="atoNeeded"><option value="0">No</option><option value="4">Yes</option></select></div>
          <div><label for="atoDocs">ATO Documentation Available</label><select id="atoDocs"><option value="0">Yes</option><option value="4">No</option></select></div>
          <div>
            <label for="azureEnclaveStatus">Azure Enclave Accredited</label>
            <select id="azureEnclaveStatus">
              <option value="0">N/A</option>
              <option value="0">Yes</option>
              <option value="5">No</option>
              <option value="3">In progress</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>3. Quantified Scale Inputs</h2>
      <div class="grid options-grid">
        <div><label for="q_users">Total Users</label><select id="q_users"><option value="1">Less than 10</option><option value="2">11 to 20</option><option value="3">21 to 50</option><option value="4">50 to 100</option><option value="5">Over 100</option></select></div>
        <div><label for="q_rto">RTO Requirements</label><select id="q_rto"><option value="1">Mission Critical (minutes)</option><option value="2">Business Critical (hours)</option><option value="3">Low Critical (days)</option></select></div>
        <div><label for="q_opsCost">Operations Costs</label><select id="q_opsCost"><option value="1">Less than $1,000</option><option value="2">$1,000 to $1,999</option><option value="3">$2,000 to $4,999</option><option value="4">$5,000 to $9,999</option><option value="5">$10,000 to $19,999</option><option value="6">$20,000 to $50,000</option><option value="7">Greater than $50,000</option></select></div>
        <div><label for="q_dataVolume">Data Volume</label><select id="q_dataVolume"><option value="1">10 GB</option><option value="2">10 to 100 GB</option><option value="3">100 GB to 1 TB</option><option value="4">1 TB+</option><option value="2">I don't know</option></select></div>
        <div><label for="q_loc">Total Lines of Code</label><select id="q_loc"><option value="1">Small (less than 1000 lines)</option><option value="2">Medium (1000 to 5000 lines)</option><option value="3">Large (Over 5000 lines)</option></select></div>
        <div><label for="q_dbConfig">Database Configuration</label><select id="q_dbConfig"><option value="1">Single Database</option><option value="2">Multiple Databases</option><option value="2">Other</option></select></div>
        <div><label for="q_storageType">Data Storage Type</label><select id="q_storageType"><option value="1">Hot</option><option value="2">Warm</option><option value="3">Cold</option></select></div>
        <div><label for="q_instancesDev">Dev Instances</label><select id="q_instancesDev"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4+</option></select></div>
        <div><label for="q_instancesTest">Test Instances</label><select id="q_instancesTest"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4+</option></select></div>
        <div><label for="q_instancesStaging">Staging Instances</label><select id="q_instancesStaging"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4+</option></select></div>
        <div><label for="q_instancesProd">Prod Instances</label><select id="q_instancesProd"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4+</option></select></div>
        <div><label for="q_instancesRel">Rel Instances</label><select id="q_instancesRel"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4+</option></select></div>
      </div>
    </div>

    <div class="card">
      <h2>4. Complexity Factors (Boolean Effort Drivers)</h2>
      <div class="grid options-grid option-grid">
        <label class="option-item"><input id="c_onPremDependency" type="checkbox" /> On-prem dependency</label>
        <label class="option-item"><input id="c_hybridDependency" type="checkbox" /> Hybrid dependency</label>
        <label class="option-item"><input id="c_containerizationRequired" type="checkbox" /> Containerization required</label>
        <label class="option-item"><input id="c_automatedTestingMissing" type="checkbox" /> Automated testing missing / needs building</label>
        <label class="option-item"><input id="c_manualTestingExtended" type="checkbox" /> Manual testing required beyond normal</label>
        <label class="option-item"><input id="c_deploymentInfraMissing" type="checkbox" /> Deployment infra missing / needs building</label>
        <label class="option-item"><input id="c_iacMissing" type="checkbox" /> IaC missing / needs building</label>
        <label class="option-item"><input id="c_loggingUplift" type="checkbox" /> Logging/observability uplift required</label>
        <label class="option-item"><input id="c_backupDrMissing" type="checkbox" /> Backup/DR missing / needs building</label>
        <label class="option-item"><input id="c_identityIntegrationRequired" type="checkbox" /> Identity management integration required</label>
        <label class="option-item"><input id="c_featureTrackingMissing" type="checkbox" /> Feature/issue tracking missing</label>
      </div>
      <div class="mt-075 flex-row">
        <button class="btn" type="button" id="recalcBtn">Recalculate</button>
        <button class="btn btn-reset" type="button" id="resetBtn">Reset Weights &amp; Model</button>
      </div>
    </div>

    <div class="card">
      <h2>5. Scoring Weights</h2>
      <p class="desc">Adjust complexity factor weights without editing code.</p>
      <div class="grid options-grid">
        <div><label for="w_c_onPremDependency">On-prem dependency weight</label><input id="w_c_onPremDependency" type="number" step="1" value="8" /></div>
        <div><label for="w_c_hybridDependency">Hybrid dependency weight</label><input id="w_c_hybridDependency" type="number" step="1" value="6" /></div>
        <div><label for="w_c_containerizationRequired">Containerization required weight</label><input id="w_c_containerizationRequired" type="number" step="1" value="7" /></div>
        <div><label for="w_c_automatedTestingMissing">Automated testing missing weight</label><input id="w_c_automatedTestingMissing" type="number" step="1" value="5" /></div>
        <div><label for="w_c_manualTestingExtended">Manual testing extended weight</label><input id="w_c_manualTestingExtended" type="number" step="1" value="4" /></div>
        <div><label for="w_c_deploymentInfraMissing">Deployment infra missing weight</label><input id="w_c_deploymentInfraMissing" type="number" step="1" value="6" /></div>
        <div><label for="w_c_iacMissing">IaC missing weight</label><input id="w_c_iacMissing" type="number" step="1" value="6" /></div>
        <div><label for="w_c_loggingUplift">Logging uplift weight</label><input id="w_c_loggingUplift" type="number" step="1" value="5" /></div>
        <div><label for="w_c_backupDrMissing">Backup/DR missing weight</label><input id="w_c_backupDrMissing" type="number" step="1" value="6" /></div>
        <div><label for="w_c_identityIntegrationRequired">Identity integration weight</label><input id="w_c_identityIntegrationRequired" type="number" step="1" value="6" /></div>
        <div><label for="w_c_featureTrackingMissing">Feature tracking missing weight</label><input id="w_c_featureTrackingMissing" type="number" step="1" value="2" /></div>
      </div>
    </div>

    <div class="card">
      <h2>6. Service Packages</h2>
      <p class="desc">Same scope score, different staffing caps and pricing multipliers.</p>
      <div class="pricing-grid" role="list" aria-label="Service packages">
        <section class="pricing-card" role="listitem" aria-labelledby="pkg-standard-title"><header class="pricing-header"><h3 id="pkg-standard-title">Standard</h3><div class="pricing-sub">Up to <strong>3</strong> people</div></header><div class="pricing-price"><div class="pricing-price-label">Estimated Cost</div><div class="pricing-price-value"><span class="pricing-currency">$</span><span id="pkg-standard-cost">0</span></div></div><dl class="pricing-kv"><div class="pricing-kv-row"><dt>Daily rate</dt><dd id="pkg-standard-rate">$0</dd></div><div class="pricing-kv-row"><dt>Person-days</dt><dd id="pkg-standard-days">0</dd></div><div class="pricing-kv-row"><dt>Total hours</dt><dd id="pkg-standard-hours">0</dd></div><div class="pricing-kv-row"><dt>Person-sprints</dt><dd id="pkg-standard-personSprints">0</dd></div><div class="pricing-kv-row"><dt>Sprint capacity (hours)</dt><dd id="pkg-standard-sprintCapacityHours">0</dd></div></dl></section>
        <section class="pricing-card pricing-featured" role="listitem" aria-labelledby="pkg-recommended-title"><header class="pricing-header"><div class="pricing-badge" aria-hidden="true">Recommended</div><h3 id="pkg-recommended-title">Recommended</h3><div class="pricing-sub">Up to <strong>6</strong> people</div></header><div class="pricing-price"><div class="pricing-price-label">Estimated Cost</div><div class="pricing-price-value"><span class="pricing-currency">$</span><span id="pkg-recommended-cost">0</span></div></div><dl class="pricing-kv"><div class="pricing-kv-row"><dt>Daily rate</dt><dd id="pkg-recommended-rate">$0</dd></div><div class="pricing-kv-row"><dt>Person-days</dt><dd id="pkg-recommended-days">0</dd></div><div class="pricing-kv-row"><dt>Total hours</dt><dd id="pkg-recommended-hours">0</dd></div><div class="pricing-kv-row"><dt>Person-sprints</dt><dd id="pkg-recommended-personSprints">0</dd></div><div class="pricing-kv-row"><dt>Sprint capacity (hours)</dt><dd id="pkg-recommended-sprintCapacityHours">0</dd></div></dl></section>
        <section class="pricing-card" role="listitem" aria-labelledby="pkg-express-title"><header class="pricing-header"><h3 id="pkg-express-title">Expedited</h3><div class="pricing-sub">Up to <strong>9</strong> people</div></header><div class="pricing-price"><div class="pricing-price-label">Estimated Cost</div><div class="pricing-price-value"><span class="pricing-currency">$</span><span id="pkg-express-cost">0</span></div></div><dl class="pricing-kv"><div class="pricing-kv-row"><dt>Daily rate</dt><dd id="pkg-express-rate">$0</dd></div><div class="pricing-kv-row"><dt>Person-days</dt><dd id="pkg-express-days">0</dd></div><div class="pricing-kv-row"><dt>Total hours</dt><dd id="pkg-express-hours">0</dd></div><div class="pricing-kv-row"><dt>Person-sprints</dt><dd id="pkg-express-personSprints">0</dd></div><div class="pricing-kv-row"><dt>Sprint capacity (hours)</dt><dd id="pkg-express-sprintCapacityHours">0</dd></div></dl></section>
      </div>
    </div>

    <div class="card">
      <h2>7. Effort &amp; Cost Model</h2>
      <div class="grid options-grid">
        <div><label for="basePersonDays">Base Person-Days per Score Point</label><input id="basePersonDays" type="number" step="0.1" value="0.4" /></div>
        <div><label for="dailyRate">Daily Rate (USD)</label><input id="dailyRate" type="number" step="50" value="1200" /></div>
        <div><label for="workDaysPerMonth">Work Days per Month</label><input id="workDaysPerMonth" type="number" step="1" value="20" /></div>
        <div><label for="hoursPerDay">Hours per Work Day</label><input id="hoursPerDay" type="number" step="0.5" value="6" /></div>
        <div><label for="sprintHours">Hours Per Person Per Sprint</label><input id="sprintHours" type="number" step="1" value="60" /></div>
        <div><label for="teamMembers">Team Members Available</label><input id="teamMembers" type="number" step="1" value="3" /></div>
        <div><label for="standardThreshold">Standard Threshold</label><input id="standardThreshold" type="number" step="1" value="40" /></div>
        <div><label for="recommendedThreshold">Recommended Threshold</label><input id="recommendedThreshold" type="number" step="1" value="90" /></div>
      </div>
    </div>
  </div>

  <script>
    const packageDefs = [
      { key: 'standard', teamCap: 3, rateMultiplier: 1.0 },
      { key: 'recommended', teamCap: 6, rateMultiplier: 2.0 },
      { key: 'express', teamCap: 9, rateMultiplier: 3.0 }
    ];

    const defaultComplexityWeights = {
      c_onPremDependency: 8,
      c_hybridDependency: 6,
      c_containerizationRequired: 7,
      c_automatedTestingMissing: 5,
      c_manualTestingExtended: 4,
      c_deploymentInfraMissing: 6,
      c_iacMissing: 6,
      c_loggingUplift: 5,
      c_backupDrMissing: 6,
      c_identityIntegrationRequired: 6,
      c_featureTrackingMissing: 2
    };

    function getComplexityWeight(id) {
      return getNumber('w_' + id, defaultComplexityWeights[id] ?? 0);
    }

    function getNumber(id, fallback = 0) {
      const element = document.getElementById(id);
      if (!element) return fallback;
      const value = parseFloat(element.value);
      return Number.isFinite(value) ? value : fallback;
    }

    function formatMoney(value) {
      return Number.isFinite(value) ? '$' + Math.round(value).toLocaleString() : '$0';
    }

    function setText(id, value) {
      const element = document.getElementById(id);
      if (element) element.textContent = value;
    }

    function bucketFor(score) {
      const standardThreshold = getNumber('standardThreshold', 40);
      const recommendedThreshold = getNumber('recommendedThreshold', 90);
      if (score <= 0) return '–';
      if (score < standardThreshold) return 'Standard';
      if (score < recommendedThreshold) return 'Recommended';
      return 'Express';
    }

    function applyBucketClass(el, bucket) {
      if (!el) return;
      el.className = 'pill';
      if (bucket === 'Standard') el.classList.add('badge-s');
      else if (bucket === 'Recommended') el.classList.add('badge-m');
      else if (bucket === 'Express') el.classList.add('badge-xl');
    }

    function getQuantifiedScore() {
      const quantifiedIds = [
        'q_users', 'q_rto', 'q_opsCost', 'q_dataVolume', 'q_loc', 'q_dbConfig', 'q_storageType',
        'q_instancesDev', 'q_instancesTest', 'q_instancesStaging', 'q_instancesProd', 'q_instancesRel'
      ];
      return quantifiedIds.reduce((sum, id) => sum + getNumber(id, 0), 0);
    }

    function getComplexityScore() {
      return Object.keys(defaultComplexityWeights).reduce((sum, id) => {
        return sum + (document.getElementById(id)?.checked ? getComplexityWeight(id) : 0);
      }, 0);
    }

    function getSecurityContextScore() {
      let score = 0;
      score += getNumber('impactLevelRequired', 1);
      score += getNumber('secCap', 0);
      score += getNumber('atoNeeded', 0);
      score += getNumber('atoDocs', 0);
      score += getNumber('azureEnclaveStatus', 0);

      const enclaveChecks = ['enclaveIL2', 'enclaveIL4', 'enclaveIL5', 'enclaveIL6', 'enclaveOther'];
      const selectedCount = enclaveChecks.filter((id) => document.getElementById(id)?.checked).length;
      score += selectedCount;
      return score;
    }

    function calculate() {
      const quantifiedScore = getQuantifiedScore();
      const complexityScore = getComplexityScore();
      const securityScore = getSecurityContextScore();
      const totalScore = quantifiedScore + complexityScore + securityScore;

      const basePersonDays = getNumber('basePersonDays', 0.4);
      const dailyRate = getNumber('dailyRate', 1200);
      const hoursPerDay = getNumber('hoursPerDay', 6);
      const sprintHours = getNumber('sprintHours', 60);
      const teamMembers = getNumber('teamMembers', 3);

      const personDays = totalScore * basePersonDays;
      const totalHours = personDays * hoursPerDay;
      const personSprints = sprintHours > 0 ? totalHours / sprintHours : 0;
      const calendarSprints = teamMembers > 0 ? personSprints / teamMembers : 0;
      const estimatedCost = personDays * dailyRate;

      setText('totalScore', totalScore.toFixed(1));
      setText('estimatedPersonDays', personDays.toFixed(1));
      setText('totalHours', totalHours.toFixed(1));
      setText('personSprints', personSprints.toFixed(2));
      setText('calendarSprints', calendarSprints.toFixed(2));
      setText('estimatedCost', formatMoney(estimatedCost));

      const modes = [
        { key: 'Standard', effortMultiplier: 1.0, scoreMultiplier: 1.0 },
        { key: 'Recommended', effortMultiplier: 1.25, scoreMultiplier: 1.25 },
        { key: 'Express', effortMultiplier: 1.5, scoreMultiplier: 1.5 }
      ];

      modes.forEach((mode) => {
        const bucket = bucketFor(totalScore * mode.scoreMultiplier);
        const hours = totalHours * mode.effortMultiplier;
        const cost = estimatedCost * mode.effortMultiplier;
        const bucketEl = document.getElementById('sizeBucket' + mode.key);
        if (bucketEl) {
          bucketEl.textContent = bucket;
          applyBucketClass(bucketEl, bucket);
        }
        setText('manHours' + mode.key, hours.toFixed(1));
        setText('cost' + mode.key, formatMoney(cost));
      });

      packageDefs.forEach((pkg) => {
        const rate = dailyRate * pkg.rateMultiplier;
        const cost = personDays * rate;
        const sprintCapacityHours = sprintHours * pkg.teamCap;
        const prefix = 'pkg-' + pkg.key;
        document.getElementById(prefix + '-cost').textContent = Math.round(cost).toLocaleString();
        document.getElementById(prefix + '-rate').textContent = formatMoney(rate);
        document.getElementById(prefix + '-days').textContent = personDays.toFixed(1);
        document.getElementById(prefix + '-hours').textContent = totalHours.toFixed(1);
        document.getElementById(prefix + '-personSprints').textContent = personSprints.toFixed(2);
        document.getElementById(prefix + '-sprintCapacityHours').textContent = sprintCapacityHours.toFixed(0);
      });
    }

    function resetDefaults() {
      document.querySelectorAll('input[type="checkbox"]').forEach((checkbox) => {
        checkbox.checked = false;
      });

      const defaults = {
        basePersonDays: '0.4',
        dailyRate: '1200',
        workDaysPerMonth: '20',
        hoursPerDay: '6',
        sprintHours: '60',
        teamMembers: '3',
        standardThreshold: '40',
        recommendedThreshold: '90',
        impactLevelRequired: '1',
        secCap: '0',
        atoNeeded: '0',
        atoDocs: '0',
        azureEnclaveStatus: '0'
      };

      Object.entries(defaultComplexityWeights).forEach(([id, value]) => {
        defaults['w_' + id] = String(value);
      });

      Object.entries(defaults).forEach(([id, value]) => {
        const element = document.getElementById(id);
        if (element) element.value = value;
      });

      calculate();
    }

    function exportProgress() {
      const data = {};
      document.querySelectorAll('input, select, textarea').forEach((el) => {
        if (!el.id) return;
        data[el.id] = el.type === 'checkbox' ? el.checked : el.value;
      });
      let appName = (data.appName || '').trim();
      if (!appName) appName = 'migration-tool';
      appName = appName.replace(/[^a-z0-9\-_]+/gi, '_');
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const anchor = document.createElement('a');
      anchor.href = url;
      anchor.download = appName + '-size-estimate.json';
      document.body.appendChild(anchor);
      anchor.click();
      setTimeout(() => {
        document.body.removeChild(anchor);
        URL.revokeObjectURL(url);
      }, 100);
    }

    function importProgressFromFile(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const data = JSON.parse(e.target.result);
          Object.entries(data).forEach(([id, value]) => {
            const element = document.getElementById(id);
            if (!element) return;
            if (element.type === 'checkbox') element.checked = Boolean(value);
            else element.value = String(value ?? '');
          });
          calculate();
          alert('Progress imported successfully!');
        } catch (err) {
          alert('Failed to import: ' + err.message);
        }
      };
      reader.readAsText(file);
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('input, select, textarea').forEach((el) => {
        el.addEventListener('change', calculate);
        if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') el.addEventListener('keyup', calculate);
      });

      document.getElementById('recalcBtn').addEventListener('click', calculate);
      document.getElementById('resetBtn').addEventListener('click', resetDefaults);
      document.getElementById('exportBtn').addEventListener('click', exportProgress);
      document.getElementById('importBtn').addEventListener('click', () => document.getElementById('importInput').click());
      document.getElementById('importInput').addEventListener('change', (e) => {
        if (e.target.files && e.target.files[0]) importProgressFromFile(e.target.files[0]);
      });

      resetDefaults();
    });
  </script>
</body>
</html>
